name: Deploy Documentation

on:
  push:
    branches: [ docs/gh-pages-setup ]  # Trigger on main branch
  workflow_dispatch:  # Allow manual triggering

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # Needed to push to gh-pages branch
      pages: write     # Needed to deploy to GitHub Pages
      id-token: write  # Needed for GitHub Pages deployment
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Fetch all history for proper versioning
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -e ".[docs]"
          pip install sphinx sphinx-rtd-theme sphinx-copybutton
      
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: docs/_build/html  # Built documentation
          branch: gh-pages          # Target branch
          clean: true               # Remove old files
          token: ${{ secrets.GITHUB_TOKEN }}
          keep-files: false        # Clean the target branch
          single-commit: true       # Single commit for cleaner history
          commit-message: "Deploy docs: $(date +'%Y-%m-%d %H:%M:%S')"
